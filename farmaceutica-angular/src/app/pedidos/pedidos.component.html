<div class="container d-flex flex-column" style="min-height: 600px;">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0">Pedidos</h2>
    @if (auth.getUser()?.['rol'] === 'Gerente') {
    <button class="btn btn-success" routerLink="/nuevo-pedido">
      + Nuevo Pedido
    </button>
    }
  </div>

  <div class="d-flex flex-column flex-grow-1">
    <!-- FILTROS -->
    <div class="row g-2 mb-3">
      <div class="col-md-6">
        <input type="text" class="form-control" placeholder="Filtrar por medicamento..." [value]="filterMedName()"
          (input)="onNameFilter($any($event.target).value)" />
      </div>
      <div class="col-md-4">
        <select class="form-select" [value]="filterProvider()" (change)="onProviderFilter($any($event.target).value)">
          <option value="">-- Filtrar por proveedor --</option>
          @for (pr of providerOptions(); track pr.codigo) {
          <option [value]="pr.codigo">{{ pr.nombre }}</option>
          }
        </select>
      </div>
      <div class="col-md-2">
        <button class="btn btn-outline-secondary w-100" (click)="onNameFilter(''); onProviderFilter('')">
          Limpiar
        </button>
      </div>
    </div>
    <div class="table-responsive flex-grow-1">
      <table class="table table-striped table-bordered mb-0">
        <thead class="table-dark">
          <tr>
            <th># Pedido</th>
            <th>Medicamento</th>
            <th>Cantidad</th>
            <th>Proveedor</th>
            @if (auth.getUser()?.['rol'] === 'Gerente') {
            <th>Acciones</th>
            }
          </tr>
        </thead>
        <tbody>
          @for (p of pagedPedidos(); track p._id) {
          <tr>
            <td>{{ p.numero_pedido }}</td>
            <td>{{ p.nombre_medicamento }}</td>
            <td>{{ p.cantidad_pedida }}</td>
            <td>
              @for (prov of proveedores(); track prov._id) {
              @if (p.codigo_proveedor === prov.codigo) {
              {{ prov.nombre }}
              }
              }
            </td>
            @if (auth.getUser()?.['rol'] === 'Gerente') {
            <td>
              <button class="btn btn-warning btn-sm me-2" (click)="openEdit(p)">
                Editar
              </button>
              <button class="btn btn-danger btn-sm" (click)="onDelete(p._id)">
                Borrar
              </button>
            </td>
            }
          </tr>
          }
        </tbody>
      </table>
    </div>

    <!-- Modal de edición -->
    @if (selected()) {
    <app-mini-pedido [pedido]="selected()!" (onClose)="closeEdit()" (onSave)="onUpdate($event)"></app-mini-pedido>
    }
  </div>

  <!-- Paginación con margen reducido -->
  <nav class="mt-1">
    <ul class="pagination justify-content-center mb-0">
      <li class="page-item" [class.disabled]="currentPage() === 1">
        <button class="page-link" (click)="prevPage()">Anterior</button>
      </li>
      @for (pg of pages(); track pg) {
      <li class="page-item" [class.active]="pg === currentPage()">
        <button class="page-link" (click)="goToPage(pg)">{{ pg }}</button>
      </li>
      }
      <li class="page-item" [class.disabled]="currentPage() === totalPages()">
        <button class="page-link" (click)="nextPage()">Siguiente</button>
      </li>
    </ul>
  </nav>
</div>
<div class="m-2">
  <button class="btn btn-primary" routerLink="/">Volver</button>
</div>